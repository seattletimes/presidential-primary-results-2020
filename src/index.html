<% 
  var results = json.results.races[0].results[0],
    show_all_candidates = true;

  var d = new Date(),
    timestring = d.toLocaleTimeString("en-US").replace(/:\d+ /, ' '),
    timestamp = timestring.split(" ")[0] + " " + timestring.split(" ")[1][0].toLowerCase() + ".m.";
%><!doctype html>
<html lang="en-US">
  <head>
    <%= t.include("partials/_head.html", grunt.data.json) %>
    <% if (json.project.production && !json.project.embedded) { %>
      <%= t.include("partials/_dataLayer.html") %>
      <%= t.include("partials/_gtm.html") %>
    <% } %>
    <meta http-equiv="refresh" content="30">
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body>
    <% if (json.project.production && !json.project.embedded) { %>
      <%= t.include("partials/_gtmNoScript.html") %>
    <% } %>
    <responsive-child>
      <main class="interactive">
        <h1>Presidential primary results</h1>
        <p class="note note--timestamp">Last updated <%= timestamp %></p>
        <div class="flexbox">
          <div id="map">
            <div id="tooltip" class="hidden"></div>
            <%= t.include("assets/countyMap.svg") %>
          </div>
          <div id="results">
            <p id="statewide-button" class="hidden">Back to statewide results</p>
            <h2 id="place-name">Washington state</h2>
            <p class="note note--precincts"><span id="reporting-percentage"><%= results.reportingPercentage %></span>% of precincts reporting</p>
            <ul id="candidates">
              <% json.candidates.forEach(function(candidate) { %>
                <% if (show_all_candidates === true) { %>
                  <li><span class="color-block <%= candidate.last %>"></span><%= candidate.first %> <%= candidate.last %>: <%= (results.candidates.find(c => c.last === candidate.last).percentage === null) ? 0 : results.candidates.find(c => c.last === candidate.last).percentage %>%</li>
                <% } else { %>
                  <% if (candidate.show === true) { %>
                    <li><span class="color-block <%= candidate.last %>"></span><%= candidate.first %> <%= candidate.last %>: <%= (results.candidates.find(c => c.last === candidate.last).percentage === null) ? 0 : results.candidates.find(c => c.last === candidate.last).percentage %>%</li>
                  <% } %>
                <% } %>
              <% }); %>
            </ul>
          </div>
        </div>
        <div class="caption">
          <p class="data-source">Source: Associated Press</p>
          <p class="art-credit">Hilary Fung / The Seattle Times</p>
        </div>
      </main>
    </responsive-child>

    <script src="app.js" async></script>
    <% if (json.project.production) { %>
    <%= !json.project.embedded ? t.include("partials/_analytics.html") : "" %>
    <%= t.include("partials/_workHere.html") %>
    <% } %>
  </body>
</html>
